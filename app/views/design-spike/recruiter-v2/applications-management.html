{% extends "layout.html" %}

{% block pageTitle %}Applications Management{% endblock %}

{% block content %}
  <a href="/design-spike/recruiter-v2/recruiter-dashboard" class="nhsuk-back-link">Back to Dashboard</a>

  <h1 class="nhsuk-heading-xl">Manage Applications</h1>

  <p>Review applications, filter by role or status, and take bulk actions.</p>

  <!-- ðŸ“Œ Filtering & Bulk Actions Section -->
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-one-third">
      <div class="nhsuk-form-group">
        <label class="nhsuk-label" for="filter-role">Filter by Role:</label>
        <select class="nhsuk-select" id="filter-role" onchange="filterApplications()">
          <option value="all" selected>All Roles</option>
          <option value="ward-volunteer">Ward Volunteer</option>
          <option value="hospital-reception">Hospital Reception Volunteer</option>
        </select>
      </div>
    </div>

    <div class="nhsuk-grid-column-one-third">
      <div class="nhsuk-form-group">
        <label class="nhsuk-label" for="filter-status">Filter by Status:</label>
        <select class="nhsuk-select" id="filter-status" onchange="filterApplications()">
          <option value="all" selected>All Statuses</option>
          <option value="new">New</option>
          <option value="reviewed">Reviewed</option>
          <option value="shortlisted">Shortlisted</option>
          <option value="approved">Approved</option>
          <option value="rejected">Rejected</option>
        </select>
      </div>
    </div>

    <div class="nhsuk-grid-column-one-third">
      <div class="nhsuk-form-group">
        <label class="nhsuk-label" for="bulk-action">Bulk Actions:</label>
        <select class="nhsuk-select" id="bulk-action">
          <option value="shortlist">Shortlist Selected</option>
          <option value="approve">Approve Selected</option>
          <option value="reject">Reject Selected</option>
          <option value="request-info">Request More Info</option>
        </select>
      </div>
      <button type="button" class="nhsuk-button" onclick="applyBulkAction()">Apply Action</button>
    </div>
  </div>

  <!-- ðŸ“Œ Applications Table -->
  <table class="nhsuk-table">
    <thead>
      <tr>
        <th><input type="checkbox" id="select-all" onclick="toggleSelectAll()"></th>
        <th>Applicant Name</th>
        <th>Role</th>
        <th>Date Applied</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="applications-table">
      <!-- Sample Applications -->
      <tr data-role="ward-volunteer" data-status="new">
        <td><input type="checkbox" class="applicant-checkbox"></td>
        <td>Jane Doe</td>
        <td>Ward Volunteer</td>
        <td>10 April 2025</td>
        <td><span class="nhsuk-tag nhsuk-tag--blue">New</span></td>
        <td>
          <ul class="nhsuk-list">
            <li><a href="#">Review</a></li>
            <li><a href="#">Request More Info</a></li>
            <li><a href="#">Shortlist</a></li>
            <li><a href="#">Approve</a></li>
            <li><a href="#" class="nhsuk-link nhsuk-u-text-color-red">Reject</a></li>
          </ul>
        </td>
      </tr>
      <tr data-role="hospital-reception" data-status="reviewed">
        <td><input type="checkbox" class="applicant-checkbox"></td>
        <td>John Smith</td>
        <td>Hospital Reception Volunteer</td>
        <td>8 April 2025</td>
        <td><span class="nhsuk-tag nhsuk-tag--grey">Reviewed</span></td>
        <td>
          <ul class="nhsuk-list">
            <li><a href="#">Review</a></li>
            <li><a href="#">Shortlist</a></li>
            <li><a href="#">Approve</a></li>
            <li><a href="#" class="nhsuk-link nhsuk-u-text-color-red">Reject</a></li>
          </ul>
        </td>
      </tr>
      <tr data-role="ward-volunteer" data-status="shortlisted">
        <td><input type="checkbox" class="applicant-checkbox"></td>
        <td>Emily Brown</td>
        <td>Ward Volunteer</td>
        <td>7 April 2025</td>
        <td><span class="nhsuk-tag nhsuk-tag--yellow">Shortlisted</span></td>
        <td>
          <ul class="nhsuk-list">
            <li><a href="#">Approve</a></li>
            <li><a href="#" class="nhsuk-link nhsuk-u-text-color-red">Reject</a></li>
          </ul>
        </td>
      </tr>
      <tr data-role="hospital-reception" data-status="approved">
        <td><input type="checkbox" class="applicant-checkbox"></td>
        <td>Michael Lee</td>
        <td>Hospital Reception Volunteer</td>
        <td>5 April 2025</td>
        <td><span class="nhsuk-tag nhsuk-tag--green">Approved</span></td>
        <td>
          <ul class="nhsuk-list">
            <li><a href="#">View Profile</a></li>
          </ul>
        </td>
      </tr>
      <tr data-role="ward-volunteer" data-status="rejected">
        <td><input type="checkbox" class="applicant-checkbox"></td>
        <td>Sophie Taylor</td>
        <td>Ward Volunteer</td>
        <td>3 April 2025</td>
        <td><span class="nhsuk-tag nhsuk-tag--red">Rejected</span></td>
        <td>-</td>
      </tr>
    </tbody>
  </table>

  <script>
    function toggleSelectAll() {
      let checkboxes = document.querySelectorAll('.applicant-checkbox');
      let selectAll = document.getElementById('select-all');
      checkboxes.forEach(checkbox => checkbox.checked = selectAll.checked);
    }

    function applyBulkAction() {
      let selectedAction = document.getElementById('bulk-action').value;
      let selectedApplicants = document.querySelectorAll('.applicant-checkbox:checked');

      if (selectedApplicants.length === 0) {
        alert("Please select at least one application.");
        return;
      }

      let actionText = {
        "shortlist": "shortlisted",
        "approve": "approved",
        "reject": "rejected",
        "request-info": "sent a request for more information"
      };

      alert(`${selectedApplicants.length} application(s) have been ${actionText[selectedAction]}.`);
    }

    function filterApplications() {
      let selectedRole = document.getElementById('filter-role').value;
      let selectedStatus = document.getElementById('filter-status').value;
      let rows = document.querySelectorAll('#applications-table tr');

      rows.forEach(row => {
        let roleMatch = (selectedRole === "all" || row.getAttribute('data-role') === selectedRole);
        let statusMatch = (selectedStatus === "all" || row.getAttribute('data-status') === selectedStatus);

        row.style.display = (roleMatch && statusMatch) ? "" : "none";
      });
    }
  </script>

{% endblock %}
